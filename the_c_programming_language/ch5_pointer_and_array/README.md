# 第五章 指针与数组

## 5.1 指针与地址
机器有一系列连续编号或编址单元,这些存储单元可以单个进行操纵,也可以连续成组的方式进行操纵.通常情况下,机器的一个字节可以存放一个char类型数据,两个相邻字节可以存放一个short类型数据,4个相邻字节可以存放一个long类型数据.指针能够存放一个地址或者一组存储单元(通常是2个或4个字节).

一元运算符`&`可用于取一个对象的地址,因此,下列语句:
```cpp
p = &c
```
将把c的地址赋给p,称p为指向p的指针. 地址运算符只用于内存中的对象,即变量与数组元素, 它不能作用于表达式,常量或者`register`类型的变量.

一元运算符`*`是间接寻址或间接引用运算符当它作用于指针时,将访问指针所指的对象.

一元运算符`*`与`&`的优先级比算数运算优先级高,因此,赋值语句:
```cpp
*p += 1
```
将*p的对象的值取出并+1,它等同于
```cpp
++*p
// 或者
(* p)++
```
语句`*(p)++`括号必不可少,否则表达式会对p加一而不是指向的对象

## 5.2 指针与函数参数
由于C中是以传值得方式将参数传给调用函数,因此,被调用的函数不能直接修改主函数中变量的值.例如,函数定义为以下形式:
```cpp
void swap(int x, int y) {
  int temp;

  temp = x;
  x = y;
  y = temp;
}
```
则下列语句无法达到目的
```cpp
swap(a, b);
```
这是因为上述函数不会影响到调用它的例程中参数a,b的值,仅仅交换了副本的值;

实现目标可以使主调程序指向所要交换的变量的指针传递给被调用函数,即
```cpp
swap(&a, &b);
```
由于一元运算符`&`用来取地址,这样`&a`就是一个指向变量a的指针.`swap`函数所有参数声明为指针,并且通过指针间接访问他们的操作数.
```cpp
void swap(int *px, int *py) {
  int temp;

  temp = * px;
  * px = * py;
  * py = temp;
}
```

来看这样一个例子:

函数getint接受自由格式的输入,并执行转换,将输入的字符流分解成整数,每次调用得到一个整数.getint返回得到的整数,并且,在到达输入结尾时要返回文件结束的标记.这些值必须通过不同方式返回.EOF可以用任何值表示,也可以用一个输入值表示

## 5.3 指针与数组

`int a[10]` 定义了一个长度为10的由10个对象组成的集合,这十个对象存储在相邻内存区域中,a[i]表示第i个元素,若pa声明为
```cpp
int *pa;
```
那么他是一个指向整型对象的指针,那么,赋值语句
```cpp
pa = &a[0];
```
则可以指向数组a的第0个元素,也就是说,pa的值为数组元素a[0]的地址.
```cpp
x = *pa;
```
把a[0]的内容复制到变量x中.

执行语句
```cpp
pa = &a[0]
```
后, pa与a具有相同的值,因为数组名所代表的是该数组第一个元素的地址,所以上面语句也可以写成
```cpp
pa = a;
```
在计算数组a[i]的值时,c语言实际上先将其转化为`*(a+i)`的形式.然后再进行求值.

指针是一个变量,`p++`是合法的,数组名不是变量,`a++`语句是非法的

当把数组名传递给一个函数时,实际传递的是第一个元素的地址. 调用函数中,该参数是一个局部变量, 因此,数组名参数必须是一个指针, 也就是一个存储地址值得变量.
``` cpp
int strlen(char *s){
  int n;

  for (n = 0; *s != '\0'; s++) {
    n++;
  }
  return n;
}
```
执行s++运算并不会影响调用者的字符串,它仅对该指针在strlen的副本中进行自增运算.

在函数定义中,形式参数
``` cpp
char s[]
```
和
```cpp
char *s;
```
是等价的. 我们通常更习惯后一种形式,因为他比前者更直观表明这个参数是个指针.如果把数组名传给函数,函数可以根据情况判定是按照数组处理还是按照指针处理,然后根据相应的方法操作参数. 为了直观且恰当地表示主函数,函数中甚至可以同时使用数组和指针两种方法.

也可以将指向子数组起始位置的指针传给函数,这样,就将数组的一部分传给函数,例如
```cpp
f(&a[2])
```
与
```cpp
f(a+2)
```
都将把起始于a[2]的子数组的地址传给f,对于函数来说,它并不关心所引用的是否是一个更大数组的部分元素.

如果确信相应的元素存在,也可以通过下标访问第一个元素之前的元素.`p[-1]`在语法上是合法的,当然, 引用数组边外的对象是非法的.
